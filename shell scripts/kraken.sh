#!/bin/bash
clear

#ascii art made using http://www.ascii-art-generator.org/
echo "[0;34;40m                                                       [0m
[0;34;40m                  [0;32;40m.8[0;32;46m@@@@@@@@@@@@@@8[0;30;42m8[0;34;40mS[0;32;40m.    [0;34;40m             [0m
[0;34;40m                 [0;32;40mt[0;1;30;90;46m [0;36;5;46;106m [0;1;32;92;46m8[0;36;5;46;106m [0;36;5;42;102m.[0;36;5;46;106m:.[0;36;5;42;102m:[0;1;36;96;46mX[0;32;46mS;[0;36;5;46;106m [0;36;5;42;102m:[0;36;5;46;106m.[0;1;36;96;46m.[0;1;32;92;5;46;106m@[0;36;5;46;106m  [0;36;5;42;102m%[0;32;46m8[0;34;40m                 [0m
[0;34;40m                .[0;32;46mt[0;1;32;92;5;46;106m8[0;1;36;96;5;42;102m8[0;36;5;46;106m [0;36;5;42;102m [0;36;5;46;106m:[0;36;5;42;102m.[0;1;36;96;46mS[0;32;46mX[0;32;40m;;;X[0;1;30;90;46m [0;1;32;92;5;46;106m888[0;36;5;42;102m [0;36;5;46;106m:[0;1;36;96;46m:[0;36;5;46;106m.[0;32;40m@[0;31;40m     [0;34;40m           [0m
[0;34;40m              [0;32;40m;[0;36;42m8[0;32;46m8@X[0;1;32;92;46m8[0;36;5;46;106m :[0;1;32;92;46m8[0;1;30;90;46m [0;32;40m8[0;34;40m. [0;32;40m  .t[0;30;42mX[0;1;36;96;46m:[0;36;5;46;106m [0;36;5;42;102m.[0;36;5;46;106m [0;32;5;42;102mS[0;36;42m8[0;32;46m8[0;36;42m8[0;34;40mt[0;32;40m.   [0;34;40m          [0m
[0;34;40m              :[0;32;46mS[0;1;36;96;46mt[0;1;32;92;46m8[0;30;42m8[0;32;46m8[0;36;5;42;102m%[0;1;36;96;46m:[0;36;42m8[0;32;40m:[0;34;40m.  [0;31;40m   [0;34;40m.[0;32;40m:@[0;32;46mt[0;36;5;46;106m [0;1;32;92;42m8[0;34;40m8[0;32;46m8[0;1;36;96;46m;[0;1;32;92;46m8[0;36;42m8[0;34;40m              [0m
[0;34;40m              [0;32;46m8[0;1;36;96;46m:[0;1;32;92;5;46;106m8[0;32;46mS[0;34;40m:[0;32;46m@[0;36;5;46;106m;[0;36;5;42;102mX[0;34;40m%[0;32;40m.[0;34;40m   [0;31;40m   [0;34;40m .[0;32;40m:[0;36;42m@[0;1;32;92;46m8[0;1;36;96;46mS[0;32;40m@X[0;1;36;96;46m:[0;36;5;46;106m [0;32;46m8[0;32;40mX[0;34;40m.            [0m
[0;34;40m            [0;32;40m [0;36;42m8[0;1;36;96;46m.[0;36;5;42;102m.[0;1;30;90;46m [0;30;42m8[0;36;42m8[0;32;46m:[0;1;32;92;46m8[0;1;36;96;46mt[0;30;42m8[0;34;40m;[0;32;40m.[0;34;40m [0;31;40m    [0;32;40m .;[0;32;46m%[0;36;5;46;106m [0;36;5;42;102m:[0;1;30;90;46m [0;32;40mX[0;36;42m@8[0;1;36;96;46m:[0;1;32;92;46m8[0;32;40mt[0;34;40m:[0;31;40m  [0;34;40m         [0m
[0;34;40m           [0;32;40m.[0;32;46m8[0;1;32;92;46m8[0;1;36;96;46m:[0;32;46m@[0;34;40m.[0;32;46m8[0;1;36;96;46m.[0;36;5;46;106m [0;36;5;42;102m [0;36;5;46;106m;[0;1;32;92;46m8[0;32;46mS[0;32;40m.[0;34;40m  [0;31;40m [0;32;40m   8[0;1;36;96;46m;[0;36;5;42;102m:[0;1;36;96;46mS[0;36;5;46;106m:[0;1;32;92;46m8[0;32;46m.[0;32;40m88[0;32;46m%[0;1;36;96;46m:[0;1;32;92;46m8[0;32;40mX[0;34;40m;[0;31;40m  [0;32;40m  [0;34;40m      [0m
[0;34;40m           [0;32;40m8[0;1;36;96;46mt[0;36;5;46;106m:[0;36;42m%[0;31;40m [0;34;40m:[0;32;46m;[0;36;5;42;102m [0;1;36;96;46mS[0;36;5;46;106m;[0;36;5;42;102m8[0;32;46mX[0;32;40mS[0;34;40m:[0;32;40m     [0;34;40m.[0;32;40mt[0;32;46m@[0;1;30;90;46m [0;36;5;42;102m:[0;1;36;96;46mt[0;1;32;92;5;46;106m8[0;1;36;96;46m.[0;36;42m8[0;32;40m:8[0;1;32;92;46m8[0;36;5;46;106mt[0;32;46m8[0;32;40m:   [0;34;40m       [0m
[0;34;40m          .[0;32;46m8[0;1;32;92;46m88[0;32;40m8[0;34;40m:[0;32;40m;[0;32;46mX[0;1;36;96;46m;[0;36;5;42;102m:[0;1;36;96;46m;[0;1;32;92;46m8[0;32;40m@[0;34;40mt[0;32;40m      [0;34;40m..[0;32;40m.[0;32;46m%[0;36;5;46;106mt[0;36;5;42;102mt[0;1;36;96;46mt[0;36;5;42;102m%[0;34;40m8[0;32;40m;[0;34;40mt[0;32;46m8[0;1;32;92;46m88[0;34;40mS[0;32;40m:  [0;34;40m       [0m
[0;34;40m           [0;32;40mt[0;32;46m:[0;1;36;96;46m:[0;32;46m@[0;32;40mt[0;34;40m.[0;32;40m;[0;36;42m8[0;1;30;90;46m [0;32;46mS[0;1;32;92;46m8[0;1;36;96;46m:[0;36;42m@[0;32;40m%[0;34;40m:[0;32;40m.[0;34;40m  [0;32;40m %[0;36;42m8[0;32;46m%[0;1;32;92;46m8[0;32;46m;;8[0;32;40mX[0;34;40m;[0;32;40m:X[0;32;46m:[0;1;36;96;46m:[0;36;42m8[0;32;40m:[0;34;40m          [0m
[0;34;40m          .[0;32;40m.[0;30;42m8[0;1;32;92;46m8[0;1;36;96;46m:[0;32;46mX[0;36;42m8[0;32;46mt@[0;30;42m@[0;32;40mX[0;34;40mS[0;32;46m8[0;32;40m8[0;34;40m8[0;36;42m8[0;34;40m.[0;32;40m  8[0;1;30;90;46m [0;31;40m [0;32;46mX[0;36;42m@[0;32;40m;[0;30;42m8[0;32;46mS:@[0;36;42m8[0;32;46m;[0;1;32;92;46m8[0;32;46mX[0;32;40m;[0;34;40m           [0m
[0;34;40m         [0;31;40m [0;34;40m .t[0;32;46mt[0;36;5;42;102m.[0;1;30;90;46m [0;36;42m8[0;32;40mS[0;34;40m;;:[0;32;40m;[0;32;46m8.[0;36;42m8[0;32;40m@%[0;34;40m:;[0;32;40mX8[0;32;46m;%[0;32;40m@[0;34;40m;:[0;32;40m:S[0;30;42m8[0;1;30;90;46m [0;1;32;92;46m8[0;1;36;96;46m;[0;36;42mS[0;34;40m            [0m
[0;34;40m           [0;32;40m %[0;32;46m;[0;1;30;90;46m [0;32;40m;[0;34;40m.:[0;32;40m:8[0;32;46mX@;[0;36;42m8[0;32;40m:[0;34;40m;:[0;32;40m.[0;34;40m.;:[0;30;42m8[0;32;46m:t8[0;36;42m8[0;34;40m:;.[0;32;40m:[0;30;42m@[0;32;46m:[0;36;42mX[0;34;40m            [0m
[0;34;40m          [0;32;40m [0;34;40m [0;32;40m:[0;36;42mX[0;32;40m   [0;36;42m8[0;32;46m%:[0;1;32;92;46m88[0;32;46mS[0;32;40m;[0;34;40m.[0;31;40m  [0;32;40m  .[0;34;40m.[0;32;40m.[0;36;42mS[0;32;46mt[0;1;32;92;46m8[0;32;46m.S8[0;32;40mS[0;34;40m::[0;36;42m@[0;34;40m;            [0m
[0;34;40m         [0;32;40m [0;34;40m   .   [0;32;46m8%[0;1;32;92;46m8[0;1;36;96;46m;[0;32;46m%[0;32;40m8[0;34;40m. [0;32;40m :t;[0;34;40m:[0;32;40m [0;34;40m .[0;36;42m8[0;1;32;92;46m888[0;32;46m.[0;30;42m8[0;34;40m: .[0;32;40m [0;34;40m            [0m
[0;34;40m                [0;31;40m [0;32;40m:[0;36;42m8[0;32;46m;[0;1;32;92;46m8[0;30;42m8[0;34;40m; [0;32;40m.[0;36;42m8[0;32;46mS%%8[0;32;40m@[0;34;40m: :[0;32;46mX[0;1;30;90;46m [0;32;46m%[0;30;42mS[0;34;40mt                [0m
[0;34;40m                   [0;30;42m@[0;32;46m8[0;34;40m:  [0;32;40mX[0;32;46m8[0;32;40m88[0;30;42m8[0;32;46m@[0;36;42m8[0;34;40m.[0;31;40m [0;34;40m [0;32;40mS[0;32;46m8[0;32;40mX[0;34;40m;[0;31;40m [0;34;40m                [0m
[0;34;40m                  .:   .::;;; .  ..[0;32;40m.[0;34;40m.[0;31;40m   [0;34;40m               [0m
[0;34;40m                            [0;31;40m [0;34;40m    [0;31;40m       [0;32;40m [0;34;40m              [0m
[0;34;40m                                 [0;31;40m       [0;34;40m               [0m

"
#ascii art made using http://www.ascii-art-generator.org/
function full_setup(){
	#It is always a good Idea to run update before new install. 
	echo "Should we run update?(y/n)"
	read update
	if [ "$update" = "y" ]
	then
		run_update
	fi
	echo "Should we create user and move to directory?(y/n)"
	read createusr
	if [ "$createusr" = "y" ]
		then
		create_user
	fi
	echo "Should we create 1 gig swap space?(y/n)"
	read swap
	if [ "$swap" = "y" ]
		then
		run_swap
	fi
	echo "Should we install dependencies?(y/n)"
	read dependencies
	if [ "$dependencies" = "y" ]
		then
		install_dependancies
	fi
	echo "Should we install wallet?(y/n)"
	read wallet
	if [ "$wallet" = "y" ]
		then
		install_wallet
	fi
	echo "Should we update configuration?(y/n)"
	read conf
	if [ "$conf" = "y" ]
	then
		update_conf
	fi
	restart_service
}
function run_update() {
	echo "Updating"
	apt-get update
	apt-get upgrade -y
}
function create_user() {
#it is recomended to create a new user espetialy if you want to insall more than one maser node of the same coin.
	echo "Please enter user name to add"
	read username
	sudo useradd -m $username
	cd /home/$username
}
function run_swap(){
#Swap space is the area on a hard disk which is part of the Virtual Memory of your machine, which is a combination of accessible physical memory (RAM) and the swap space. 
#Swap space temporarily holds memory pages that are inactive. 
#Swap space is used when your system decides that it needs physical memory for active processes and there is insufficient unused physical memory available. 
#If the system happens to need more memory resources or space, inactive pages in physical memory are then moved to the swap space therefore freeing up that physical memory for other uses. 
#Note that the access time for swap is slower therefore do not consider it to be a complete replacement for the physical memory. 
#Swap space can be a dedicated swap partition (recommended), a swap file, or a combination of swap partitions and swap files.
    echo "Making 1 gig swap space"
		sudo dd if=/dev/zero of=/var/swap.img bs=1024k count=1000
		sudo mkswap /var/swap.img
		sudo swapon /var/swap.img
		sudo chmod 0600 /var/swap.img
		sudo chown root:root /var/swap.img
		#sudo nano /etc/fstab
		echo "/var/swap.img none swap sw 0 0" >> /etc/fstab
}

function install_dependancies(){
    echo "Installing dependencies"
	sudo apt-get -y update && sudo apt-get -y install build-essential libssl-dev libdb++-dev libboost-all-dev libcrypto++-dev libqrencode-dev libminiupnpc-dev libgmp-dev libgmp3-dev autoconf autogen automake libtool
	sudo apt-get install git
}

function install_wallet(){
	if [ -n "$username" ]; then
		cd /home/$username
	else
		echo "Please enter the username where the wallet needs to be installed"
		read username
		cd /home/$username
	fi
	
	cp /home/$username/Kraken /home/$username/Kraken_backup
	rm -r /home/$username/Kraken
	
	git clone https://github.com/krakencoins/Kraken.git
	if [ -n "$username" ]; then
		cd /home/$username/Kraken/src
	else
		echo "Please enter the username where the wallet needs to be installed"
		read username
		cd /home/$username/Kraken/src
	fi
	echo "Compiling the wallet"
	make -f makefile.unix
}
function update_conf {
	echo "Updating conf"
	echo "Please enter mater node User Name"
	read yourrandomuser
	echo "Please enter mater node Password:"
	read yourrandompassword
	echo "Please enter master node port"
	read mnport
	echo "Please enter master node key or leave blank if you don't have one yet"
	read masternodeprivkey

cat <<EOF > /root/.Kraken/Kraken.conf
rpcuser=$yourrandomuser
rpcpassword=$yourrandompassword
rpcallowip=127.0.0.1
rpcport=$mnport
listen=1
server=1
daemon=1
port=$mnport
logintimestamps=1
maxconnections=256
masternode=1
masternodeprivkey=$masternodeprivkey
EOF
}
function restart_service(){
	if [ -n "$username" ]; 
	then
		cd /home/$username
	else
		echo "Please enter the username where the wallet needs to be installed"
		read username
		cd /home/$username
	fi
	cd Kraken/src
	./Krakend
}
echo -e "[0;01;44mFunction Menu \n[0;34;0m"

echo -e "1. Run full setup \t 2. Run update only \t\t 3. Create user"
echo -e "4. Make swap space \t 5. Install dependencies \t 6. Install wallet"
echo -e "7. Update conf \t\t 8. Restart  \t\t\t 9. Exit"
echo -e " \nEnter number to run function"
read input_value
if [ "$input_value" = "1" ]
	then
		full_setup
fi
if [ "$input_value" = "2" ]
	then
		run_update
fi
if [ "$input_value" = "3" ]
	then
		create_user
fi
if [ "$input_value" = "4" ]
	then
		run_swap
fi
if [ "$input_value" = "5" ]
	then
		install_dependancies
fi
if [ "$input_value" = "6" ]
	then
		install_wallet
fi
if [ "$input_value" = "7" ]
	then
		update_conf
fi
if [ "$input_value" = "8" ]
	then
		restart_service
fi
if [ "$input_value" = "9" ]
	then
		exit 1
fi

